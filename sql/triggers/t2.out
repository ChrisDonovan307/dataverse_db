SQL> 
SQL> 
SQL> -- Execute scripts  --------------------------------------------------
SQL> 
SQL> start &&1
SQL> -- Trigger 2: adjustColFilesCount
SQL> 
SQL> create or replace trigger adjustColFilesCount
  2  after insert or delete on files
  3  for each row
  4  declare
  5  	     CID int;
  6  begin
  7  	     if inserting then
  8  		     -- get col_ID of dataset affected, save as CID
  9  		     select col_ID
 10  		     into CID
 11  		     from dataset
 12  		     where ds_ID = :NEW.ds_ID;
 13  
 14  		     -- add to n_files count of collection
 15  		     update collection
 16  		     set n_files = n_files + 1
 17  		     where col_ID = CID;
 18  
 19  	     elsif deleting then
 20  		     -- get col_ID of dataset affected, save as CID
 21  		     select col_ID
 22  		     into CID
 23  		     from dataset
 24  		     where ds_ID = :OLD.ds_ID;
 25  
 26  		     -- subtract from n_files count of collection
 27  		     update collection
 28  		     set n_files = n_files - 1
 29  		     where col_ID = CID;
 30  	     end if;
 31  end;
 32  /

Trigger created.

SQL> 
SQL> show errors
No errors.
SQL> 
SQL> 
SQL> -- check number of files in a certain collection
SQL> select n_files
  2  from collection
  3  where col_ID = 1;

   N_FILES                                                                      
----------                                                                      
       200                                                                      

SQL> 
SQL> -- insert into files
SQL> insert into files values (
  2  	     'test',
  3  	     (select ds_ID from dataset where col_ID = 1 fetch first 1 row only),
  4  	     null,
  5  	     null,
  6  	     null,
  7  	     null,
  8  	     null,
  9  	     null
 10  );

1 row created.

SQL> 
SQL> 
SQL> -- See if it worked
SQL> select n_files
  2  from collection
  3  where col_ID = 1;

   N_FILES                                                                      
----------                                                                      
       201                                                                      

SQL> 
SQL> -- delete from files
SQL> delete from files
  2  where file_ID = 'test';

1 row deleted.

SQL> 
SQL> -- See if it worked
SQL> select n_files
  2  from collection
  3  where col_ID = 1;

   N_FILES                                                                      
----------                                                                      
       200                                                                      

SQL> 
SQL> -- Reset everything
SQL> rollback;

Rollback complete.

SQL> drop trigger adjustColFilesCount;

Trigger dropped.

SQL> 
SQL> SQL> 
SQL> 
SQL> -- Restore options --------------------------------------------------
SQL> 
SQL> spool off
