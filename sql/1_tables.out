SQL> 
SQL> 
SQL> -- Execute scripts  -------------------------------------------
SQL> 
SQL> start &&1
SQL> -- Create tables without foreign keys first ----------
SQL> 
SQL> create table institution (
  2  	     int_ID int primary key,
  3  	     name varchar(1000),
  4  	     address varchar(500)
  5  );

Table created.

SQL> 
SQL> create table license (
  2  	     lic_ID int primary key,
  3  	     name varchar(15),
  4  	     url varchar(250)
  5  );

Table created.

SQL> 
SQL> create table funding_agency (
  2  	     agency_ID int primary key,
  3  	     name varchar(250),
  4  	     total_amount number,
  5  	     location varchar(25)
  6  );

Table created.

SQL> 
SQL> create table grants ( -- Oracle does not allow grant as a name
  2  	     grant_ID int primary key,
  3  	     grant_number varchar(250),
  4  	     amount number
  5  );

Table created.

SQL> 
SQL> create table software_license (
  2  	     sw_lic_ID int primary key,
  3  	     name varchar(20),
  4  	     url varchar(100),
  5  	     gpl_compatible char(1) check (gpl_compatible in ('T', 'F'))
  6  	     -- NOTE: does Oracle not have a boolean data type?
  7  	 -- Looks like using T/F or 1/0 are the only options. Weird.
  8  );

Table created.

SQL> 
SQL> create table software (
  2  	     sw_ID int primary key,
  3  	     name varchar(25),
  4  	     description varchar(25)
  5  );

Table created.

SQL> 
SQL> create table users ( -- user is another oracle conflict. change to users
  2  	     u_ID int primary key,
  3  	     email varchar(30) -- max 26
  4  );

Table created.

SQL> 
SQL> create table root_dataverse (
  2  	     root_ID int primary key,
  3  	     title varchar(50),
  4  	     url varchar(50),
  5  	     description varchar(500)
  6  );

Table created.

SQL> 
SQL> 
SQL> -- Now tables with foreign keys. Work down from root ----------
SQL> 
SQL> create table collection (
  2  	     col_ID int primary key,
  3  	     root_ID int references root_dataverse (root_ID),
  4  	     title varchar(500),
  5  	     description varchar(1000),
  6  	     pub_date date,
  7  	     n_files int,
  8  	     n_datasets int,
  9  	     file_downloads int
 10  );

Table created.

SQL> 
SQL> create table dataset (
  2  	     ds_ID varchar(50) primary key,
  3  		     -- ds_ID is a DOI
  4  	     col_ID int references collection (col_ID),
  5  	     lic_ID int references license (lic_ID),
  6  	     sw_lic_ID int references software_license (sw_lic_ID),
  7  	     title varchar(300),
  8  		     -- max is 260
  9  	     description varchar(1000),
 10  		     -- cut off descriptions at 900 chars in R
 11  		     -- maybe better off leaving it though?
 12  	     pub_date date,
 13  	     file_downloads int,
 14  	     n_files int,
 15  	     url varchar(50) -- max is 33
 16  );

Table created.

SQL> 
SQL> create table files (
  2  		     -- cannot use 'file' as table name, making it files
  3  	     file_ID varchar(50) primary key,
  4  		     -- this is a DOI
  5  	     ds_ID varchar(50) references dataset (ds_ID),
  6  	 filetype varchar(100) check (filetype in (
  7  	     'Adobe PDF',
  8  	     'AVI Video',
  9  	     'Comma Separated Values',
 10  	     'Fixed Field Text Data',
 11  	     'Gzip Archive',
 12  	     'JSON',
 13  	     'Markdown Text',
 14  	     'Mathematica',
 15  	     'MATLAB Data',
 16  	     'MATLAB Source Code',
 17  	     'MS Excel Spreadsheet',
 18  	     'MS Word',
 19  	     'Network Common Data Form',
 20  	     'Plain Text',
 21  	     'PNG Image',
 22  	     'Python Source Code',
 23  	     'Quicktime Video',
 24  	     'R Syntax',
 25  	     'Rich Text Format',
 26  	     'Shapefile as ZIP Archive',
 27  	     'Stata Syntax',
 28  	     'Tab-Delimited',
 29  	     'TAR Archive',
 30  	     'TIFF Image',
 31  	     'Unknown',
 32  	     'XZ Archive',
 33  	     'ZIP Archive'
 34  	 )),
 35  	     filesize numeric,
 36  	     title varchar(1000),
 37  	     description varchar(1000),
 38  	     downloads int,
 39  	     pub_date date
 40  );

Table created.

SQL> 
SQL> create table subjects (
  2  	     ds_ID varchar(50) references dataset (ds_ID),
  3  	     subject varchar(100) check (subject in (
  4  	     'Arts and Humanities',
  5  	     'Astronomy and Astrophysics',
  6  	     'Business and Management',
  7  	     'Chemistry',
  8  	     'Computer and Information Science',
  9  	     'Earth and Environmental Sciences',
 10  	     'Engineering',
 11  	     'Law',
 12  	     'Mathematical Sciences',
 13  	     'Medicine, Health and Life Sciences',
 14  	     'Other',
 15  	     'Physics',
 16  	     'Social Sciences'
 17  	 )),
 18  	     primary key (ds_ID, subject)
 19  );

Table created.

SQL> 
SQL> create table registered_user (
  2  	     ru_ID int primary key,
  3  	     u_ID int references users (u_id),
  4  	 name varchar(50),
  5  	     privilege varchar(5) check (privilege in ('read', 'write')),
  6  	     pw_hash varchar(25)
  7  );

Table created.

SQL> 
SQL> create table author (
  2  	     auth_ID int primary key,
  3  	     ru_ID int references registered_user (ru_ID),
  4  	     orcid varchar(20)
  5  		     -- orcid should technically be a static 19 chars
  6  		     -- but I might have added weird numbers to these if missing
  7  );

Table created.

SQL> 
SQL> create table affiliation (
  2  	     int_ID int references institution (int_ID),
  3  	     ru_ID int references registered_user (ru_ID)
  4  );

Table created.

SQL> 
SQL> create table publication (
  2  	     pub_ID int primary key,
  3  	     ds_ID varchar(50) references dataset (ds_ID),
  4  	     citation varchar(750),
  5  	     url varchar(250)
  6  );

Table created.

SQL> 
SQL> create table produce (
  2  	     auth_ID int references author (auth_ID),
  3  	     pub_ID int references publication (pub_ID)
  4  );

Table created.

SQL> 
SQL> create table file_upload (
  2  	     auth_ID int references author (auth_ID),
  3  	     file_ID varchar(50) references files (file_ID),
  4  	     timestamp timestamp
  5  );

Table created.

SQL> 
SQL> create table file_download (
  2  	     file_ID varchar(50) references files (file_ID),
  3  	     u_ID int references users (u_ID),
  4  	     timestamp timestamp
  5  );

Table created.

SQL> 
SQL> create table dataset_upload (
  2  	     ds_ID varchar(50) references dataset (ds_ID),
  3  	     auth_ID int references author (auth_ID),
  4  	     timestamp timestamp
  5  );

Table created.

SQL> 
SQL> create table dataset_download (
  2  	     ds_ID varchar(50) references dataset (ds_ID),
  3  	     u_ID int references users (u_ID),
  4  	     timestamp timestamp
  5  );

Table created.

SQL> 
SQL> create table keywords (
  2  	     ds_ID varchar(50) references dataset (ds_ID),
  3  	     keyword varchar(100)
  4  );

Table created.

SQL> 
SQL> create table funds (
  2  	     grant_ID int references grants (grant_ID),
  3  	     ds_ID varchar(50) references dataset (ds_ID),
  4  	     agency_ID int,
  5  	     primary key (grant_ID, ds_ID, agency_ID)
  6  );

Table created.

SQL> 
SQL> create table admin (
  2  	     ru_ID int references registered_user (ru_ID),
  3  	     start_date date
  4  );

Table created.

SQL> 
SQL> create table manage_dataverse (
  2  	     ru_ID int references registered_user (ru_ID),
  3  	     root_ID int references root_dataverse (root_ID),
  4  	     timestamp timestamp,
  5  	     description varchar(1000)
  6  );

Table created.

SQL> 
SQL> create table manage_collection (
  2  	     col_ID int references collection (col_ID),
  3  	     ru_ID int references registered_user (ru_ID),
  4  	     timestamp timestamp,
  5  	     description varchar(500)
  6  );

Table created.

SQL> 
SQL> 
SQL> create table contact (
  2  	     u_ID int references users (u_ID),
  3  	     ds_ID varchar(50) references dataset (ds_ID),
  4  	     timestamp timestamp,
  5  	     message varchar(500)
  6  );

Table created.

SQL> 
SQL> create table analyzes (
  2  	     sw_ID int references software (sw_ID),
  3  	     ds_ID varchar(50) references dataset (ds_ID),
  4  	     title varchar(500),
  5  	     description varchar(1000),
  6  	     repo_url varchar(250)
  7  );

Table created.

SQL> 
SQL> 
SQL> 
SQL> SQL> 
SQL> 
SQL> -- Restore options --------------------------------------------
SQL> 
SQL> spool off
